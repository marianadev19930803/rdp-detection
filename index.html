<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Remote Session Detection</title>
</head>
<body style="background:#111; color:#fff; font-family:Arial;">

<script>
(function() {

    // ===== UI Panel =====
    var panel = document.createElement("div");
    panel.style.position = "fixed";
    panel.style.top = "10px";
    panel.style.right = "10px";
    panel.style.backgroundColor = "rgba(0,0,0,0.85)";
    panel.style.color = "#fff";
    panel.style.padding = "12px";
    panel.style.fontFamily = "Arial, sans-serif";
    panel.style.fontSize = "14px";
    panel.style.borderRadius = "6px";
    panel.style.zIndex = 99999;
    panel.style.width = "270px";
    panel.innerHTML = "<b>Remote Session Score</b><br>Loading...";
    document.body.appendChild(panel);

    // ===== Screen & DPI =====
    var sw = window.screen.width;
    var sh = window.screen.height;
    var dpr = window.devicePixelRatio;

    var screenScore = 0;
    if (sw < 800 || sh < 600) screenScore += 15;
    if (dpr !== 1) screenScore += 10;

    // ===== GPU Check =====
    var gpuScore = 0;
    try {
        var canvas = document.createElement("canvas");
        var gl = canvas.getContext("webgl") || canvas.getContext("experimental-webgl");
        if (gl) {
            var debug = gl.getExtension("WEBGL_debug_renderer_info");
            if (debug) {
                var renderer = gl.getParameter(debug.UNMASKED_RENDERER_WEBGL);
                if (/Microsoft Remote Display|VMware|Virtual|AnyDesk|RDP/i.test(renderer)) {
                    gpuScore = 25;
                }
            }
        }
    } catch (e) {}

    // ===== Mouse anomalies =====
    var lastX = null, lastY = null;
    var anomalyCount = 0;
    var mouseScore = 0;

    document.addEventListener("mousemove", function(e){
        if(lastX !== null && lastY !== null){
            var dx = e.screenX - lastX;
            var dy = e.screenY - lastY;
            var dist = Math.sqrt(dx*dx + dy*dy);
            if(dist===0) anomalyCount++;
            if(anomalyCount > 30){ 
                mouseScore = 15;
                anomalyCount = 0;
            }
        }
        lastX = e.screenX;
        lastY = e.screenY;
    });

    // ===== Frame time tracking =====
    var lastFrame = performance.now();
    var frameTimes = [];
    var maxFrames = 3;

    function addFrame(dt){
        frameTimes.push(dt);
        if(frameTimes.length > maxFrames) frameTimes.shift();
    }

    function avgFrame(){
        var sum = 0;
        for(var i=0;i<frameTimes.length;i++) sum += frameTimes[i];
        return frameTimes.length ? sum / frameTimes.length : 0;
    }

    // ===== Main loop =====
    function tick(){
        var now = performance.now();
        var dt = now - lastFrame;
        lastFrame = now;

        addFrame(dt);

        var avg = avgFrame();

        // ===== Calculate final score =====
        // Base: Screen + GPU + Mouse anomalies
        var baseScore = screenScore + gpuScore + mouseScore;

        // Frame score proportional to avg frame time
        // 16ms = 60fps → 0, 100ms → ~40 points, capped at 40
        var frameScore = Math.min(Math.max((avg - 16)/2,0),40);

        var finalScore = Math.min(baseScore + frameScore,100);

        // Determine status
        var status = "Low suspicion";
        if(finalScore >= 40 && finalScore < 70) status = "Medium suspicion";
        if(finalScore >= 70) status = "HIGH suspicion";

        // Update panel
        panel.innerHTML =
            "<b>Remote Session Score</b><br>" +
            "Score: <b>" + finalScore.toFixed(0) + "%</b><br>" +
            "Status: <b>" + status + "</b><br><br>" +
            "Avg last 10 frames: <b>" + avg.toFixed(2) + " ms</b><br>" +
            "Screen: " + sw + "×" + sh + "<br>" +
            "DPR: " + dpr;

        requestAnimationFrame(tick);
    }

    requestAnimationFrame(tick);

})();
</script>

</body>
</html>
