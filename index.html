<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Remote Session Detector</title>
</head>
<body style="background:#111; color:#fff; font-family:Arial;">

<script>
(function() {

    /* ==============================
       UI Panel
    =============================== */
    var panel = document.createElement("div");
    panel.style.position = "fixed";
    panel.style.top = "10px";
    panel.style.right = "10px";
    panel.style.backgroundColor = "rgba(0,0,0,0.85)";
    panel.style.color = "#fff";
    panel.style.padding = "12px";
    panel.style.fontFamily = "Arial, sans-serif";
    panel.style.fontSize = "14px";
    panel.style.borderRadius = "6px";
    panel.style.zIndex = 99999;
    panel.style.width = "260px";
    panel.innerHTML = "<b>Remote Session Score</b><br>Loading...";
    document.body.appendChild(panel);

    var score = 0;


    /* ==============================
       Screen & DPI Checks
    =============================== */
    var sw = window.screen.width;
    var sh = window.screen.height;
    var dpr = window.devicePixelRatio;

    if (sw < 800 || sh < 600) score += 10;
    if (dpr !== 1) score += 10;


    /* ==============================
       GPU Fingerprint Check
    =============================== */
    try {
        var canvas = document.createElement("canvas");
        var gl = canvas.getContext("webgl") || canvas.getContext("experimental-webgl");
        if (gl) {
            var debug = gl.getExtension("WEBGL_debug_renderer_info");
            if (debug) {
                var renderer = gl.getParameter(debug.UNMASKED_RENDERER_WEBGL);
                if (/Microsoft Remote Display|VMware|Virtual|AnyDesk|RDP/i.test(renderer)) {
                    score += 35;
                }
            }
        }
    } catch (e) {}


    /* ==============================
       Mouse Movement Anomalies
    =============================== */
    var lastX = null;
    var lastY = null;
    var anomaly = 0;

    document.addEventListener("mousemove", function(e) {
        if (lastX !== null && lastY !== null) {
            var dx = e.screenX - lastX;
            var dy = e.screenY - lastY;
            var dist = Math.sqrt(dx*dx + dy*dy);

            // RDP/AnyDesk sometimes sends same position repeatedly
            if (dist === 0) anomaly++;

            if (anomaly > 30) {
                score += 15;
                anomaly = 0;
            }
        }
        lastX = e.screenX;
        lastY = e.screenY;
    });


    /* ==============================
       Average of Last 10 Frame Times
    =============================== */
    var lastFrameTime = performance.now();
    var frameHistory = [];
    var maxFrames = 10;

    function addFrameTime(dt) {
        frameHistory.push(dt);
        if (frameHistory.length > maxFrames) {
            frameHistory.shift();
        }
    }

    function avgFrameTime() {
        var sum = 0;
        for (var i = 0; i < frameHistory.length; i++) {
            sum += frameHistory[i];
        }
        if (frameHistory.length === 0) return 0;
        return sum / frameHistory.length;
    }


    /* ==============================
       Main Loop
    =============================== */
    function tick() {
        var now = performance.now();
        var delta = now - lastFrameTime;
        lastFrameTime = now;

        addFrameTime(delta);

        // High frame delay → remote desktop or poor GPU virtualization
        var avg = avgFrameTime();
        if (avg > 40) score += 10;
        if (avg > 80) score += 20;

        updatePanel(avg);
        requestAnimationFrame(tick);
    }


    /* ==============================
       Update UI
    =============================== */
    function updatePanel(avg) {
        var final = Math.min(score, 100);
        
        var state = "Low suspicion";
        if (final >= 40 && final < 70) state = "Medium suspicion";
        if (final >= 70) state = "HIGH suspicion";

        panel.innerHTML =
            "<b>Remote Session Score</b><br>" +
            "Score: <b>" + final + "%</b><br>" +
            "Status: <b>" + state + "</b><br><br>" +
            "Avg last 10 frame time: <b>" + avg.toFixed(2) + " ms</b><br>" +
            "Screen: " + sw + "×" + sh + "<br>" +
            "DPR: " + dpr;
    }

    requestAnimationFrame(tick);

})();
</script>

</body>
</html>
